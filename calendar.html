<html>
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BPS2S5MCLH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-BPS2S5MCLH');
    </script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css"-->

    <style type="text/css">
      body, html {
        padding: 0;
        margin: 0;
      }
    </style>
    <script type="text/javascript">
      window.mobileCheck = function() {  // https://stackoverflow.com/questions/11381673/detecting-a-mobile-browser
        let check = false;
        (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
        return check;
      };

      const circle_radius = 2;
      const number_of_weeks_in_a_row = 52;
      const number_of_years = 90;
      const is_mobile = window.mobileCheck();

      const year_mean = 65;
      const year_median = 72;
      const year_mode = 76;
        
      function recalculate_calendar(element) {
        draw_calendar("calendar", element.value);
      }

      function calculate_weeks_since(birthday) {  // https://stackoverflow.com/questions/542938/how-to-calculate-number-of-days-between-two-dates
        const diff_ms = new Date() - new Date(birthday);
        const diff_days = diff_ms / (1000 * 60 * 60 * 24);
        return Math.floor(diff_days / 7.024038461538462);  // (365*3+366)/4/52
      }

      function prepare_weeks_numbers() {
        let content = '';

        for (let week = 1; week <= number_of_weeks_in_a_row; week++) {
          let x_offset = (week + 1) * 5;
          let cx = x_offset - circle_radius;
          content += '<text font-size="3" fill="black" font-family="Verdana" text-anchor="middle" alignment-baseline="baseline" x="' + cx + '" y="4">';
          if (week % 4 == 0) // add a marker for every 4-th week
            content += week;
          content += '</text>';
        }

        return content;
      }

      function prepare_years_numbers() {
        let content = '';

        for (let year = 1; year <= number_of_years; year++) {
          let y_offset = (year) * 5 + 5 + 1;
          if (is_mobile)  // idk why on mobiles is calculated differently
            y_offset += 1;
          //let y_offset = (year) * 5 + 5 + 2;
          let cy = y_offset - circle_radius;
          content += '<text font-size="3" fill="black" font-family="Verdana" text-anchor="middle" alignment-baseline="baseline" x="2" y="' + cy + '">'
          if (year % 5 == 0) // add a marker for every 4-th year
            content += year;
          content += '</text>';
        }

        return content;
      }

      function coordinates_to_points(coordinates) {
        const x_offset = 8;
        const y_offset = 8;
        const x_max = 263;
        const y_max = 453;
        const x_step = 5;
        const y_step = 5;
        const y_range = y_max - y_offset;

        let points = '';
        for (let x in coordinates) {
          let y = coordinates[x];
          let xx = (x - 1) * x_step + x_offset;
          let yy = (y - 1) * y_step + y_offset;
          points += yy + ',' + xx + ' ';
        }
        console.log(points)
        return points;
      }

/*
// https://github.com/SabineWren/svg-polyline-rounded-corners/blob/master/README.md

var radius = 12;

var lineToVector = function (p1, p2) {
  var vector = {
    x: p2.x - p1.x,
    y: p2.y - p1.y
  };
  return vector;
}

var vectorToUnitVector = function (v) {
  var magnitude = v.x * v.x + v.y * v.y;
  var magnitude = Math.sqrt(magnitude);
  var unitVector = {
    x: v.x / magnitude,
    y: v.y / magnitude
  };
  return unitVector;
}

var roundOneCorner = function (p1, corner, p2) {
  var corner_to_p1 = lineToVector(corner, p1);
  var corner_to_p2 = lineToVector(corner, p2);
  var corner_to_p1_unit = vectorToUnitVector(corner_to_p1);
  var corner_to_p2_unit = vectorToUnitVector(corner_to_p2);
  
  var curve_p1 = {
    x: corner.x + corner_to_p1_unit.x * radius,
    y: corner.y + corner_to_p1_unit.y * radius
  };
  var curve_p2 = {
    x: corner.x + corner_to_p2_unit.x * radius,
    y: corner.y + corner_to_p2_unit.y * radius
  };
  var path = {
    line_end: curve_p1,
    curve_control: corner,
    curve_end: curve_p2
  };
  return path;
}

var printPath = function (path) {
  console.log("L" + path.line_end.x.toFixed(1)      + "," + path.line_end.y.toFixed(1));
  console.log("Q" + path.curve_control.x.toFixed(1) + "," + path.curve_control.y.toFixed(1)
      +" "+ path.curve_end.x.toFixed(1)     + "," + path.curve_end.y.toFixed(1));
}

console.log("M"+process.argv[2]+","+process.argv[3]);
for (var i = 2; i + 5 < process.argv.length; i += 2) {
  
  var p1 = {
    x:  parseInt(process.argv[i]),
    y:  parseInt(process.argv[i+1])
  }
  var p2 = {
    x:  parseInt(process.argv[i+2]),
    y:  parseInt(process.argv[i+3])
  }
  var p3 = {
    x:  parseInt(process.argv[i+4]),
    y:  parseInt(process.argv[i+5])
  }
  var path = roundOneCorner(p1, p2, p3);
  printPath(path);
}
var lastArg = process.argv.length - 1;
console.log("L"+process.argv[lastArg-1]+","+process.argv[lastArg]);
*/

      function prepare_line_deaths() {
        let content = '';
        content += '<polyline fill="none" stroke="gray" stroke-width="2" stroke-linejoin="round" points="';
        content += coordinates_to_points({1:1, 30:5, 45:10, 65:40, 72:43, 76:44, 90:3});
        content += '"/>';

        return content;
      }

      function draw_calendar(element_id, date) {
        const circle_default_color = '#e9e9e9';
        const circle_passed_color = 'skyblue';
        
        const circle_mean_color = 'lightgray';
        const circle_median_color = 'darkgray';
        const circle_mode_color = 'gray';

        let content = '<svg viewBox="0 0 265 470" xmlns="http://www.w3.org/2000/svg" style="width: 86%; margin: 0% 7%;">';

        content += prepare_weeks_numbers();
        content += prepare_years_numbers();
        content += prepare_line_deaths();
        
        const weeks_passed = calculate_weeks_since(date);
        let weeks_drawn = 1;
        for (let year = 1; year <= number_of_years; year++) {
          let y_offset = (year + 1) * 5;
          if (is_mobile)
            y_offset = (year + 3) * 5;
          //let y_offset = (year + 1) * 5;
          //let y_offset = (year + 3) * 5;
          let cy = y_offset - circle_radius;
          //if (year == 1)
          //  document.getElementById("log").innerHTML += cy + '<br>';

          for (let week = 1; week <= number_of_weeks_in_a_row; week++) {
            let x_offset = (week + 1) * 5;
            let cx = x_offset - circle_radius;
            content += '<circle cx="' + cx + '" cy="' + cy + '" r="' + circle_radius + '" fill="';
            if (year == year_mean)
              content += circle_mean_color;
            else if (year == year_median)
              content += circle_median_color;
            else if (year == year_mode)
              content += circle_mode_color;
            else if (weeks_passed < weeks_drawn)
              content += circle_default_color;
            else
              content += circle_passed_color;

            weeks_drawn += 1;
            content += '" />';
          }
        }

        content += '</svg>';

        document.getElementById(element_id).innerHTML = content;
      }
      window.onload = function() {
        draw_calendar("calendar", "1987-06-30");
      };
    </script>
  </head>
  <body>
    <p style="color: black; text-align: center; width: 100%; margin: 10% 0 20px 0; font-size: 1em;">
      Birthday:<br>
      <input type="date" value="1987-06-30" onchange="recalculate_calendar(this);">
    </p>
    <div id="calendar"></div>
    <p style="color: black; text-align: center; width: 100%; margin: 25% 0 0px 0; font-size: 1em;">Share calendar with others:</p>
    <img src="https://www.dropbox.com/s/6j8prd7zq4htyx4/calendar-qr-code.jpg?raw=1" style="width: 50%; margin: 0 25% 20% 25%;">
    <p id="log"></p>
  </body>
</html>
